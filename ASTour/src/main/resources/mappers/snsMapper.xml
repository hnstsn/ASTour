<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 다른 mapper와 중복되지 않도록 네임스페이스 기재 -->
<mapper namespace="sns">

<!--s.spk, s.stitle, s.scontent, s.sdate, s.mpk, s.stag, s.ssort , m.mname, m.mfile, m.mfile2, m.mpath -->
<!--       SELECT * FROM sns_tbl where mpk = #{mpk } order by spk desc -->
   <select id="snsList" resultType="com.project.astour.model.dto.mypage.snsVO">
      SELECT * FROM sns_tbl where mpk = #{mpk } order by spk desc
   </select>
   
   <select id="snsfile" resultType="com.project.astour.model.dto.mypage.snsVO">
      select spk, sffile, sfpk from snsfile_tbl 
      where sfpk in (select min(sfpk) from snsfile_tbl group by spk)
   </select>

   <select id="contentview" resultType="com.project.astour.model.dto.mypage.snsVO">
      SELECT *FROM sns_tbl WHERE
      spk =#{spk }
   </select>

   <insert id="insertcontent">
      INSERT INTO sns_tbl (spk, stitle, scontent, sdate, mpk, stag, ssort)
      VALUES (sns_seq.nextval, #{stitle}, #{scontent}, sysdate, #{mpk}, #{stag}, #{ssort})
   </insert>

   <delete id="deletecontent">
      DELETE FROM sns_tbl where spk= #{spk}
   </delete>
   
   <!-- 프로필사진 -->
   <select id="memList" resultType="com.project.astour.model.dto.member.MemberVO">
      SELECT m.mpk,m.mname,p.ppk,nvl(p.pfile,'f7b5f61f-dee0-4ddc-9646-42d04e1b33d6_배경사진.jpg') as pfile,
      nvl(p.ppath,'WEB-INF/views/upload/profile') as ppath  
      FROM ASTMember m, ASTProfile p WHERE m.mpk=p.mpk(+) and m.mpk=#{mpk } 
      order by ppk desc
   </select>
   
   <!-- 사람검색 -->
   <select id="pepoleList" resultType="com.project.astour.model.dto.member.MemberVO">
      SELECT m.mpk,m.mid,m.mname,p.ppk,nvl(p.pfile,'f7b5f61f-dee0-4ddc-9646-42d04e1b33d6_배경사진.jpg') as pfile,
      nvl(p.ppath,'WEB-INF/views/upload/profile') as ppath  
      FROM ASTMember m, ASTProfile p WHERE m.mpk=p.mpk(+) and m.mname LIKE #{mname} 
   </select>

</mapper>
